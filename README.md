# Page Reader with AI - Edge 浏览器扩展

一个功能强大的 Edge 浏览器扩展，可以读取当前页面的内容，并使用 AI 进行智能分析和对话。

## 功能特性

### 📄 内容提取
- 提取页面标题和 URL
- 提取页面元标签（meta tags）
- 获取页面中的所有链接
- 获取页面中的所有图片
- 显示页面文本内容预览
- 支持动态内容加载（AJAX/SPA）
- 智能等待机制，确保内容完全加载

### 🤖 AI 对话分析
- 基于 OpenAI 兼容 API 的智能对话
- 支持多轮对话，保持对话上下文
- 自动将页面内容作为上下文传递给 AI
- 实时打字指示器
- 清除对话历史功能

### ⚙️ 灵活配置
- 自定义 API URL（支持任何 OpenAI 兼容的 API）
- 自定义模型名称（支持 Qwen、GPT、Claude 等）
- 安全存储 API Key（本地存储）
- 友好的设置界面

## 文件结构

```
ie_plugin/
├── manifest.json      # 扩展配置文件 (Manifest V3)
├── content.js         # 内容脚本，读取页面内容
├── popup.html         # 弹出界面
├── popup.js           # 弹出界面逻辑
├── icon16.png         # 16x16 图标
├── icon48.png         # 48x48 图标
└── icon128.png        # 128x128 图标
```

## 安装步骤

### 1. 在 Edge 浏览器中加载扩展

1. 打开 Edge 浏览器
2. 在地址栏输入：`edge://extensions/`
3. 打开右上角的"开发人员模式"开关
4. 点击"加载已解压的扩展"
5. 选择 `ie_plugin` 目录
6. 扩展将加载到浏览器中

## 使用方法

### 第一步：提取页面内容

1. 打开任意网页
2. 点击浏览器工具栏中的扩展图标（Page Reader with AI）
3. 在"📄 内容提取"标签页点击"Read Page Content"按钮
4. 等待内容提取完成（支持动态内容，最多等待 3 秒）

### 第二步：配置 AI 设置

1. 切换到"🤖 AI 分析"标签页
2. 点击"⚙️ API 设置"按钮
3. 配置以下信息：
   - **API URL**：API 端点地址（可选，留空使用默认 Qwen API）
   - **模型名称**：使用的模型（可选，留空使用默认模型）
   - **API Key**：认证密钥（必需）
4. 点击"保存"

### 第三步：与 AI 对话

1. 在输入框中输入你的问题
2. 点击"发送"按钮或按 Enter 键
3. AI 会基于页面内容和对话历史回答你的问题
4. 支持多轮对话，AI 会记住之前的对话内容

### 第四步：清除对话

点击"🗑️ 清除对话"按钮可以清空所有对话历史，重新开始。

## 支持的 API

本扩展支持任何兼容 OpenAI API 格式的服务：

- **Qwen API**（默认）：`https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions`
- **OpenAI API**：`https://api.openai.com/v1/chat/completions`
- **其他兼容服务**：任何支持 OpenAI API 格式的服务

### 推荐模型

- Qwen 系列：`qwen-plus-2025-07-28`、`qwen-max`、`qwen-turbo`
- OpenAI 系列：`gpt-4`、`gpt-3.5-turbo`、`gpt-4-turbo`
- 其他：任何兼容的模型

## 技术架构

### manifest.json
- 使用 Manifest V3 规范
- 权限：`activeTab`、`scripting`、`storage`
- 主机权限：`https://*/*`（支持所有 HTTPS API）

### content.js
- 在页面加载时注入
- 监听来自 popup 的消息
- 智能等待动态内容加载
- 提取页面内容并发送回 popup

### popup.js
- 处理用户交互
- 与 content script 通信
- 管理 API 调用和对话历史
- 实现 AI 对话功能

## 对话流程

扩展采用以下对话流程：

1. **系统提示**：定义 AI 的角色和任务
2. **页面上下文**：每次提问都包含完整的页面内容
3. **对话历史**：保留最近 10 条对话记录
4. **当前问题**：用户的新问题

这种设计确保 AI 始终有完整的上下文信息，能够提供准确的回答。

## 调试

### 查看日志

1. 右键点击扩展图标
2. 选择"检查弹出内容"
3. 在 Console 标签查看详细日志

### 常见错误

**404 错误**：
- 检查 API URL 是否正确
- 确认 URL 路径是否包含 `/v1/chat/completions`
- 验证模型名称是否存在

**401 错误**：
- 检查 API Key 是否正确
- 确认 API Key 是否已过期

**429 错误**：
- API 请求频率超限，请稍后再试

## 故障排除

**问题：点击按钮后显示错误**
- 解决方案：刷新当前页面，然后再次尝试

**问题：扩展图标不显示**
- 解决方案：确保图标文件存在，重新加载扩展

**问题：无法读取某些页面内容**
- 解决方案：某些网站可能有安全限制，这是正常行为

**问题：AI 回复错误或不相关**
- 解决方案：
  - 检查 API 配置是否正确
  - 确认页面内容已成功提取
  - 尝试清除对话历史重新开始

## 开发说明

### 本地开发

1. 修改代码后，在 `edge://extensions/` 页面点击扩展的刷新按钮
2. 使用浏览器控制台查看日志和调试
3. 测试各种场景和边界情况

### 代码规范

- 使用 IIFE 避免全局污染
- 使用严格模式
- 添加详细的日志记录
- 实现完善的错误处理

## 更新日志

### v2.0.0
- 添加 AI 对话功能
- 支持自定义 API URL 和模型名称
- 实现多轮对话和对话历史
- 添加清除对话功能
- 改进动态内容加载
- 优化错误处理和调试信息

### v1.0.0
- 初始版本
- 基本内容提取功能

## 许可证

MIT License

## 贡献

欢迎提交 Issue 和 Pull Request！